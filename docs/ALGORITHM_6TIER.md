# ‚úÖ Algorithm Confirmation - 6-Tier Shareholding Analysis

> **Version:** 2.0 Final  
> **Status:** ‚úÖ Implemented  
> **Last Updated:** 2025-11-28

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

| Parameter | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (3 Tier) | ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (6 Tier) |
|-----------|------------------|------------------|
| `max_levels` | 4 (Level 0-3) | 7 (Level 0-6) |
| ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Tier | 3 Tier | 6 Tier |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î | Level 3 | Level 6 |

---

## üìä 6 Tiers Explained

### Queue-Based BFS Traversal (‡∏Ç‡∏¢‡∏≤‡∏¢)

```
Start: Main Company (Level 0) - 100%
         |
         ‚Üì
    [Queue Processing]
         |
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚Üì         ‚Üì        ‚Üì        ‚Üì        ‚Üì        ‚Üì
 Tier 1   Tier 2   Tier 3   Tier 4   Tier 5   Tier 6
 (L1)     (L2)     (L3)     (L4)     (L5)     (L6)
```

---

### **Tier 1 (Level 1)** - ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **Main Company**

```
Main Company (0107548000234)
    ‚îú‚îÄ Personal Shareholder A: 30% ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô UBO candidates
    ‚îú‚îÄ Personal Shareholder B: 20% ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô UBO candidates  
    ‚îú‚îÄ Company X (regis_id): 25% ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
    ‚îú‚îÄ Company Y (regis_id): 15% ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
    ‚îî‚îÄ Company Z (regis_id): 10% ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100%
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á Main Company ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

---

### **Tier 2 (Level 2)** - ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Tier 1**

```
Company X (‡∏à‡∏≤‡∏Å Tier 1, ‡∏ñ‡∏∑‡∏≠ 25%)
    ‚îú‚îÄ Personal Shareholder C: 50% ‚Üí effective = 25% √ó 50% = 12.5%
    ‚îú‚îÄ Personal Shareholder D: 30% ‚Üí effective = 25% √ó 30% = 7.5%
    ‚îî‚îÄ Company M (regis_id): 20% ‚Üí effective = 25% √ó 20% = 5%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                   ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company X)

Company Y (‡∏à‡∏≤‡∏Å Tier 1, ‡∏ñ‡∏∑‡∏≠ 15%)
    ‚îú‚îÄ Personal Shareholder E: 60% ‚Üí effective = 15% √ó 60% = 9%
    ‚îú‚îÄ Company N (regis_id): 30% ‚Üí effective = 15% √ó 30% = 4.5%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
    ‚îî‚îÄ Personal Shareholder F: 10% ‚Üí effective = 15% √ó 10% = 1.5%
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company Y)

Company Z (‡∏à‡∏≤‡∏Å Tier 1, ‡∏ñ‡∏∑‡∏≠ 10%)
    ‚îú‚îÄ Personal Shareholder G: 80% ‚Üí effective = 10% √ó 80% = 8%
    ‚îî‚îÄ Personal Shareholder H: 20% ‚Üí effective = 10% √ó 20% = 2%
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company Z)
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô Tier 2 ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

---

### **Tier 3 (Level 3)** - ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Tier 2**

```
Company M (‡∏à‡∏≤‡∏Å Tier 2, effective 5%)
    ‚îú‚îÄ Personal Shareholder I: 40% ‚Üí effective = 5% √ó 40% = 2%
    ‚îú‚îÄ Personal Shareholder J: 30% ‚Üí effective = 5% √ó 30% = 1.5%
    ‚îî‚îÄ Company P (regis_id): 30% ‚Üí effective = 5% √ó 30% = 1.5%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company M)

Company N (‡∏à‡∏≤‡∏Å Tier 2, effective 4.5%)
    ‚îú‚îÄ Personal Shareholder K: 50% ‚Üí effective = 4.5% √ó 50% = 2.25%
    ‚îú‚îÄ Company Q (regis_id): 40% ‚Üí effective = 4.5% √ó 40% = 1.8%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
    ‚îî‚îÄ Personal Shareholder L: 10% ‚Üí effective = 4.5% √ó 10% = 0.45%
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company N)
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô Tier 3 ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

---

### **Tier 4 (Level 4)** üÜï ‡πÉ‡∏´‡∏°‡πà
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Tier 3**

```
Company P (‡∏à‡∏≤‡∏Å Tier 3, effective 1.5%)
    ‚îú‚îÄ Personal Shareholder M: 60% ‚Üí effective = 1.5% √ó 60% = 0.9%
    ‚îú‚îÄ Personal Shareholder N: 25% ‚Üí effective = 1.5% √ó 25% = 0.375%
    ‚îî‚îÄ Company R (regis_id): 15% ‚Üí effective = 1.5% √ó 15% = 0.225%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company P)

Company Q (‡∏à‡∏≤‡∏Å Tier 3, effective 1.8%)
    ‚îú‚îÄ Personal Shareholder O: 70% ‚Üí effective = 1.8% √ó 70% = 1.26%
    ‚îú‚îÄ Personal Shareholder P: 20% ‚Üí effective = 1.8% √ó 20% = 0.36%
    ‚îî‚îÄ Company S (regis_id): 10% ‚Üí effective = 1.8% √ó 10% = 0.18%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company Q)
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô Tier 4 ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

---

### **Tier 5 (Level 5)** üÜï ‡πÉ‡∏´‡∏°‡πà
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Tier 4**

```
Company R (‡∏à‡∏≤‡∏Å Tier 4, effective 0.225%)
    ‚îú‚îÄ Personal Shareholder Q: 80% ‚Üí effective = 0.225% √ó 80% = 0.18%
    ‚îú‚îÄ Personal Shareholder R: 15% ‚Üí effective = 0.225% √ó 15% = 0.034%
    ‚îî‚îÄ Company T (regis_id): 5% ‚Üí effective = 0.225% √ó 5% = 0.011%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company R)

Company S (‡∏à‡∏≤‡∏Å Tier 4, effective 0.18%)
    ‚îú‚îÄ Personal Shareholder S: 90% ‚Üí effective = 0.18% √ó 90% = 0.162%
    ‚îî‚îÄ Company U (regis_id): 10% ‚Üí effective = 0.18% √ó 10% = 0.018%, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company S)
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô Tier 5 ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

---

### **Tier 6 (Level 6)** üÜï ‡πÉ‡∏´‡∏°‡πà
**‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API:** `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á **‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Tier 5**

```
Company T (‡∏à‡∏≤‡∏Å Tier 5, effective 0.011%)
    ‚îú‚îÄ Personal Shareholder T: 100% ‚Üí effective = 0.011% √ó 100% = 0.011%
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company T)

Company U (‡∏à‡∏≤‡∏Å Tier 5, effective 0.018%)
    ‚îú‚îÄ Personal Shareholder U: 60% ‚Üí effective = 0.018% √ó 60% = 0.011%
    ‚îî‚îÄ Personal Shareholder V: 40% ‚Üí effective = 0.018% √ó 40% = 0.007%
                                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                    ‡∏£‡∏ß‡∏°: 100% (‡∏Ç‡∏≠‡∏á Company U)
```

**‚úÖ ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô Level 1 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô Tier 6 ‡∏Ñ‡∏ß‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô = 100%**

**‚õî Stop:** ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà Level 6 (‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà Tier 7)

---

## üîÑ Effective Percentage Calculation (‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö)

### ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì

```
Effective % = Parent Effective % √ó (Direct % / 100)
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°

```
Main Company (100%)
    ‚îî‚îÄ Company X (25%)                    ‚Üí effective = 100% √ó 25% = 25%
        ‚îî‚îÄ Company M (20%)                ‚Üí effective = 25% √ó 20% = 5%
            ‚îî‚îÄ Company P (30%)            ‚Üí effective = 5% √ó 30% = 1.5%
                ‚îî‚îÄ Company R (15%)        ‚Üí effective = 1.5% √ó 15% = 0.225%
                    ‚îî‚îÄ Company T (5%)     ‚Üí effective = 0.225% √ó 5% = 0.011%
                        ‚îî‚îÄ Person (100%)  ‚Üí effective = 0.011% √ó 100% = 0.011%
```

**‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:**
- Tier 1-3: ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ effective % ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ (> 1%)
- Tier 4-6: effective % ‡∏à‡∏∞‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏°‡∏≤‡∏Å (< 1%) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö beneficial ownership ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô

---

## üìã Summary Table

| Tier | Level | API Call | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå | Effective % Range (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì) |
|------|-------|----------|---------|---------------------------|
| Main | 0 | - | ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏´‡∏•‡∏±‡∏Å (100%) | 100% |
| Tier 1 | 1 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á Main | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á | 10-100% |
| Tier 2 | 2 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å Tier 1 | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° (1 ‡∏ä‡∏±‡πâ‡∏ô) | 1-50% |
| Tier 3 | 3 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å Tier 2 | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° (2 ‡∏ä‡∏±‡πâ‡∏ô) | 0.1-25% |
| **Tier 4** üÜï | 4 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å Tier 3 | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° (3 ‡∏ä‡∏±‡πâ‡∏ô) | 0.01-10% |
| **Tier 5** üÜï | 5 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å Tier 4 | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° (4 ‡∏ä‡∏±‡πâ‡∏ô) | 0.001-5% |
| **Tier 6** üÜï | 6 | `levelHeldBy level="1"` ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å Tier 5 | ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° (5 ‡∏ä‡∏±‡πâ‡∏ô) | 0.0001-2% |

---

## üîç Algorithm Code Flow (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)

```python
# Initialize - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô max_levels ‡∏à‡∏≤‡∏Å 4 ‡πÄ‡∏õ‡πá‡∏ô 7
MAX_LEVELS = 7  # Level 0-6 (6 Tiers)

processing_queue = deque([(main_company_id, 100.0, 0, [])])

while processing_queue:
    current_company_id, current_percentage, current_level, path_chain = processing_queue.popleft()
    
    # Stop at Level 6 (max_levels = 7 means levels 0-6)
    if current_level >= MAX_LEVELS:
        continue  # ‡∏Ç‡πâ‡∏≤‡∏° ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ô‡∏µ‡πâ‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ï‡πà‡∏≠)
    
    # Get Level 1 shareholders ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    company_data = api_client.get_company_data(current_company_id)
    shareholders = company_data.get('shareholders', [])  # Level 1 only
    
    for shareholder in shareholders:
        direct_percent = shareholder['percent']  # % ‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ô current_company
        effective_percent = current_percentage * (direct_percent / 100.0)
        
        if shareholder['type'] == 'personal':
            # ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô UBO candidates
            ubo_results[shareholder['name']].total_percentage += effective_percent
        
        elif shareholder['type'] == 'company':
            # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ï‡πà‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á max level)
            if current_level + 1 < MAX_LEVELS:
                processing_queue.append((
                    shareholder['regis_id'],
                    effective_percent,
                    current_level + 1,
                    path_chain + [shareholder]
                ))
```

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 6 Tier

### 1. ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Performance)

| Tier | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô API Calls (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì) | ‡πÄ‡∏ß‡∏•‡∏≤ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì) |
|------|-------------------------|---------------|
| 3 Tier | 10-50 calls | 5-30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| **6 Tier** | 50-500+ calls | 30-180 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

**‚ö†Ô∏è Warning:** ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 3 ‡πÄ‡∏õ‡πá‡∏ô 6 Tier ‡∏≠‡∏≤‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô API calls ‡πÄ‡∏õ‡πá‡∏ô 5-10 ‡πÄ‡∏ó‡πà‡∏≤

### 2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Effective %

```
Tier 6 Example:
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó A ‡∏ñ‡∏∑‡∏≠ 25% ‡∏Ç‡∏≠‡∏á Main Company
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó B ‡∏ñ‡∏∑‡∏≠ 20% ‡∏Ç‡∏≠‡∏á ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó A
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó C ‡∏ñ‡∏∑‡∏≠ 30% ‡∏Ç‡∏≠‡∏á ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó B
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó D ‡∏ñ‡∏∑‡∏≠ 15% ‡∏Ç‡∏≠‡∏á ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó C
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó E ‡∏ñ‡∏∑‡∏≠ 5% ‡∏Ç‡∏≠‡∏á ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó D
- ‡∏ô‡∏≤‡∏¢ X ‡∏ñ‡∏∑‡∏≠ 100% ‡∏Ç‡∏≠‡∏á ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó E

Effective % ‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢ X = 25% √ó 20% √ó 30% √ó 15% √ó 5% √ó 100%
                      = 0.000225% (‡πÅ‡∏ó‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
```

**‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ threshold ‡∏ï‡∏±‡∏î effective % ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡πÄ‡∏ä‡πà‡∏ô < 0.01%)

### 3. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô UI

- **‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:** Tab ‡πÅ‡∏™‡∏î‡∏á Level 1, 2, 3
- **‡πÉ‡∏´‡∏°‡πà:** ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Tab Level 4, 5, 6 ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô "Level 4+"?

### 4. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà API ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (requires_investigation) ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πÉ‡∏ô Tier 4-6 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢

---

## ‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ (Code Changes Required)

### 1. `final_ubo_system.py`

```python
# ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
# ‡πÄ‡∏î‡∏¥‡∏°:
max_levels: int = 4  # Level 0-3

# ‡πÉ‡∏´‡∏°‡πà:
max_levels: int = 7  # Level 0-6
```

### 2. `templates/enhanced_index.html`

```html
<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Tab ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Level 4, 5, 6 -->
<li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#level4">Level 4</a>
</li>
<li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#level5">Level 5</a>
</li>
<li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#level6">Level 6</a>
</li>
```

### 3. `static/locales/th.json` ‡πÅ‡∏•‡∏∞ `en.json`

```json
{
    "shareholderDetails": {
        "levelDetails": {
            "level4Tab": "‡∏£‡∏∞‡∏î‡∏±‡∏ö 4",
            "level5Tab": "‡∏£‡∏∞‡∏î‡∏±‡∏ö 5",
            "level6Tab": "‡∏£‡∏∞‡∏î‡∏±‡∏ö 6"
        }
    }
}
```

---

## üéØ Recommendation

### Option A: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 6 Tier ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡∏Å
- **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏ä‡πâ‡∏≤, API calls ‡∏°‡∏≤‡∏Å, effective % ‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å‡πÉ‡∏ô Tier 5-6

### Option B: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 5 Tier (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
- **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** Balance ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
- **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏≠‡∏≤‡∏à‡∏û‡∏•‡∏≤‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏∂‡∏Å‡∏°‡∏≤‡∏Å‡πÜ

### Option C: 6 Tier + Threshold
- **‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:** ‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ñ‡πâ‡∏≤ effective % < 0.1%
- **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô API calls ‡πÉ‡∏ô Tier ‡∏•‡∏∂‡∏Å‡πÜ
- **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏≠‡∏≤‡∏à‡∏û‡∏•‡∏≤‡∏î UBO ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó

---

## ‚úÖ Implementation Checklist (Completed)

- [x] ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 6 Tier ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‚Üí **Option A: 6 Tier ‡πÄ‡∏ï‡πá‡∏°**
- [x] ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á effective % threshold ‚Üí **‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ threshold ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î**
- [x] ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á UI ‚Üí **Tab 6 ‡∏≠‡∏±‡∏ô ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô**
- [x] ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠ performance ‚Üí **‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ**
- [x] ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö timeout ‚Üí **‡πÄ‡∏û‡∏¥‡πà‡∏° timeout ‡πÄ‡∏õ‡πá‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ**

---

## üß™ Testing

### Mock Data Test File
‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå `test_6tier_scenario.py` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö scenario ‡∏ó‡∏µ‡πà UBO ‡∏û‡∏ö‡πÉ‡∏ô Tier 6

```bash
# Run local test
cd /Users/waiywaiy/UBO
python3 test_6tier_scenario.py
```

### Expected Results
- UBO ‡∏û‡∏ö‡∏ó‡∏µ‡πà Tier 6 (Level 6)
- Effective % = 100% √ó 100% √ó 100% √ó 100% √ó 100% √ó Direct%
- 3 UBOs ‚â•15%: 
  - MR. DEEP SHAREHOLDER (25%)
  - MS. HIDDEN OWNER (20%)
  - MR. THRESHOLD HOLDER (15%)

---

**Document Version:** 2.0 Final
**Status:** ‚úÖ Implemented
**Last Updated:** 2025-11-28
